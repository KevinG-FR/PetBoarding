<div class="profile-edit-container">
  <div class="profile-edit-wrapper">
    <!-- En-tête -->
    <div class="profile-edit-header">
      <mat-icon class="profile-edit-icon">person_outline</mat-icon>
      <h1 class="profile-edit-title">Modifier le profil</h1>
      <p class="profile-edit-subtitle">
        Mettez à jour vos informations personnelles en toute sécurité
      </p>
    </div>

    <!-- Formulaire -->
    <mat-card class="profile-edit-card">
      <mat-card-content>
        <form
          [formGroup]="profileForm"
          (ngSubmit)="onSubmit()"
          novalidate
          class="profile-edit-form">
          <!-- Section informations personnelles -->
          <div class="form-section">
            <h3 class="section-title">
              <mat-icon>person</mat-icon>
              Informations personnelles
            </h3>

            <!-- Prénom et Nom -->
            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Prénom *</mat-label>
                <input
                  matInput
                  formControlName="firstName"
                  placeholder="Votre prénom"
                  autocomplete="given-name" />
                <mat-icon matSuffix>person</mat-icon>
                @if (hasError('firstName')) {
                  <mat-error>{{ getErrorMessage('firstName') }}</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Nom *</mat-label>
                <input
                  matInput
                  formControlName="lastName"
                  placeholder="Votre nom de famille"
                  autocomplete="family-name" />
                <mat-icon matSuffix>person</mat-icon>
                @if (hasError('lastName')) {
                  <mat-error>{{ getErrorMessage('lastName') }}</mat-error>
                }
              </mat-form-field>
            </div>

            <!-- Email -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Adresse email *</mat-label>
              <input
                matInput
                formControlName="email"
                type="email"
                placeholder="votre.email@exemple.com"
                autocomplete="email" />
              <mat-icon matSuffix>email</mat-icon>
              @if (hasError('email')) {
                <mat-error>{{ getErrorMessage('email') }}</mat-error>
              }
            </mat-form-field>

            <!-- Téléphone -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Numéro de téléphone *</mat-label>
              <input
                matInput
                formControlName="phoneNumber"
                type="tel"
                placeholder="06 12 34 56 78"
                autocomplete="tel" />
              <mat-icon matSuffix>phone</mat-icon>
              @if (hasError('phoneNumber')) {
                <mat-error>{{ getErrorMessage('phoneNumber') }}</mat-error>
              }
            </mat-form-field>
          </div>

          <!-- Section adresse -->
          <div class="form-section" formGroupName="address">
            <h3 class="section-title">
              <mat-icon>home</mat-icon>
              Adresse
            </h3>

            <!-- Numéro et rue -->
            <div class="form-row">
              <mat-form-field appearance="outline" class="quarter-width">
                <mat-label>Numéro *</mat-label>
                <input
                  matInput
                  formControlName="streetNumber"
                  placeholder="123"
                  autocomplete="address-line1" />
                <mat-icon matSuffix>tag</mat-icon>
                @if (hasAddressError('streetNumber')) {
                  <mat-error>{{ getAddressErrorMessage('streetNumber') }}</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="three-quarters-width">
                <mat-label>Rue *</mat-label>
                <input
                  matInput
                  formControlName="streetName"
                  placeholder="Rue de la Paix"
                  autocomplete="address-line2" />
                <mat-icon matSuffix>location_on</mat-icon>
                @if (hasAddressError('streetName')) {
                  <mat-error>{{ getAddressErrorMessage('streetName') }}</mat-error>
                }
              </mat-form-field>
            </div>

            <!-- Complément d'adresse -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Complément d'adresse</mat-label>
              <input
                matInput
                formControlName="complement"
                placeholder="Appartement, étage, bâtiment..."
                autocomplete="address-line3" />
              <mat-icon matSuffix>apartment</mat-icon>
            </mat-form-field>

            <!-- Code postal et ville -->
            <div class="form-row">
              <mat-form-field appearance="outline" class="third-width">
                <mat-label>Code postal *</mat-label>
                <input
                  matInput
                  formControlName="postalCode"
                  placeholder="75001"
                  autocomplete="postal-code" />
                <mat-icon matSuffix>markunread_mailbox</mat-icon>
                @if (hasAddressError('postalCode')) {
                  <mat-error>{{ getAddressErrorMessage('postalCode') }}</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="two-thirds-width">
                <mat-label>Ville *</mat-label>
                <input
                  matInput
                  formControlName="city"
                  placeholder="Paris"
                  autocomplete="address-level2" />
                <mat-icon matSuffix>location_city</mat-icon>
                @if (hasAddressError('city')) {
                  <mat-error>{{ getAddressErrorMessage('city') }}</mat-error>
                }
              </mat-form-field>
            </div>

            <!-- Pays -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Pays *</mat-label>
              <input
                matInput
                formControlName="country"
                placeholder="France"
                autocomplete="country-name" />
              <mat-icon matSuffix>flag</mat-icon>
              @if (hasAddressError('country')) {
                <mat-error>{{ getAddressErrorMessage('country') }}</mat-error>
              }
            </mat-form-field>
          </div>

          <!-- Indicateur de modifications -->
          @if (hasChanges()) {
            <div class="alert alert-info">
              <mat-icon>info</mat-icon>
              <span>Vous avez des modifications non sauvegardées</span>
            </div>
          }

          <!-- Boutons d'action -->
          <div class="form-actions">
            <button
              mat-stroked-button
              type="button"
              class="action-button cancel-button"
              (click)="onCancel()"
              [disabled]="isSubmitting()">
              <mat-icon>arrow_back</mat-icon>
              Retour au profil
            </button>

            <button
              mat-stroked-button
              type="button"
              class="action-button password-button"
              (click)="openChangePasswordDialog()"
              [disabled]="isSubmitting()">
              <mat-icon>lock</mat-icon>
              Changer le mot de passe
            </button>

            <button
              mat-raised-button
              type="submit"
              class="action-button submit-button"
              [disabled]="!profileForm.valid || !hasChanges() || isSubmitting()">
              @if (isSubmitting()) {
                <mat-spinner diameter="20" class="inline-spinner"></mat-spinner>
              } @else {
                <mat-icon>save</mat-icon>
              }
              {{ isSubmitting() ? 'Sauvegarde...' : 'Sauvegarder les modifications' }}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <!-- Informations additionnelles -->
    <div class="info-section">
      <h4 class="info-title">
        <mat-icon>info</mat-icon>
        Informations importantes
      </h4>
      <ul>
        <li>Votre adresse email est utilisée pour la connexion et les notifications importantes</li>
        <li>
          Votre numéro de téléphone nous permet de vous contacter en cas d'urgence concernant vos
          animaux
        </li>
        <li>
          Toutes vos informations personnelles sont sécurisées et ne seront jamais partagées avec
          des tiers
        </li>
        <li>Les modifications prendront effet immédiatement après validation</li>
      </ul>
    </div>
  </div>
</div>
