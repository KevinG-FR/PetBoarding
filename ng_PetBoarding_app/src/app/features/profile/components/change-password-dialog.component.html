<div class="change-password-dialog">
  <h2 mat-dialog-title>
    <mat-icon class="me-2">lock</mat-icon>
    Changer le mot de passe
  </h2>

  <mat-dialog-content>
    <form [formGroup]="passwordForm" class="password-form">
      <!-- Mot de passe actuel -->
      <mat-form-field appearance="outline" class="w-100 mb-3">
        <mat-label>Mot de passe actuel *</mat-label>
        <input
          matInput
          [type]="hideCurrentPassword() ? 'password' : 'text'"
          formControlName="currentPassword"
          placeholder="Votre mot de passe actuel" />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="toggleCurrentPasswordVisibility()"
          [attr.aria-label]="'Afficher/masquer le mot de passe'"
          [attr.aria-pressed]="!hideCurrentPassword()">
          <mat-icon>{{ hideCurrentPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        @if (hasError('currentPassword')) {
          <mat-error>{{ getErrorMessage('currentPassword') }}</mat-error>
        }
      </mat-form-field>

      <!-- Nouveau mot de passe -->
      <mat-form-field appearance="outline" class="w-100 mb-3">
        <mat-label>Nouveau mot de passe *</mat-label>
        <input
          matInput
          [type]="hideNewPassword() ? 'password' : 'text'"
          formControlName="newPassword"
          placeholder="Votre nouveau mot de passe" />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="toggleNewPasswordVisibility()"
          [attr.aria-label]="'Afficher/masquer le mot de passe'"
          [attr.aria-pressed]="!hideNewPassword()">
          <mat-icon>{{ hideNewPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        @if (hasError('newPassword')) {
          <mat-error>{{ getErrorMessage('newPassword') }}</mat-error>
        }
      </mat-form-field>

      <!-- Confirmer le nouveau mot de passe -->
      <mat-form-field appearance="outline" class="w-100 mb-3">
        <mat-label>Confirmer le nouveau mot de passe *</mat-label>
        <input
          matInput
          [type]="hideConfirmPassword() ? 'password' : 'text'"
          formControlName="confirmPassword"
          placeholder="Confirmez votre nouveau mot de passe" />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="toggleConfirmPasswordVisibility()"
          [attr.aria-label]="'Afficher/masquer le mot de passe'"
          [attr.aria-pressed]="!hideConfirmPassword()">
          <mat-icon>{{ hideConfirmPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        @if (hasError('confirmPassword')) {
          <mat-error>{{ getErrorMessage('confirmPassword') }}</mat-error>
        }
      </mat-form-field>

      <!-- Critères de mot de passe -->
      <div class="password-criteria mb-3">
        <h4 class="criteria-title">Critères du mot de passe :</h4>
        <ul class="criteria-list">
          <li [class.valid]="hasMinLength()" [class.invalid]="!hasMinLength()">
            <mat-icon>{{ hasMinLength() ? 'check_circle' : 'cancel' }}</mat-icon>
            Au moins 8 caractères
          </li>
          <li [class.valid]="hasUppercase()" [class.invalid]="!hasUppercase()">
            <mat-icon>{{ hasUppercase() ? 'check_circle' : 'cancel' }}</mat-icon>
            Au moins une majuscule
          </li>
          <li [class.valid]="hasLowercase()" [class.invalid]="!hasLowercase()">
            <mat-icon>{{ hasLowercase() ? 'check_circle' : 'cancel' }}</mat-icon>
            Au moins une minuscule
          </li>
          <li [class.valid]="hasNumber()" [class.invalid]="!hasNumber()">
            <mat-icon>{{ hasNumber() ? 'check_circle' : 'cancel' }}</mat-icon>
            Au moins un chiffre
          </li>
          <li [class.valid]="hasSpecialChar()" [class.invalid]="!hasSpecialChar()">
            <mat-icon>{{ hasSpecialChar() ? 'check_circle' : 'cancel' }}</mat-icon>
            Au moins un caractère spécial
          </li>
        </ul>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end" class="gap-2">
    <button mat-stroked-button (click)="onCancel()" [disabled]="isSubmitting()">Annuler</button>
    <button
      mat-raised-button
      color="primary"
      (click)="onSubmit()"
      [disabled]="!passwordForm.valid || isSubmitting()">
      @if (isSubmitting()) {
        <mat-spinner diameter="20" class="me-2"></mat-spinner>
      } @else {
        <mat-icon class="me-2">save</mat-icon>
      }
      {{ isSubmitting() ? 'Sauvegarde...' : 'Changer le mot de passe' }}
    </button>
  </mat-dialog-actions>
</div>
