<div class="form-container">
  <div class="header">
    <button mat-icon-button (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h2>{{ isEditMode ? 'Modifier la prestation' : 'Ajouter une prestation' }}</h2>
  </div>

  @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>{{ isEditMode ? 'Chargement...' : 'Sauvegarde en cours...' }}</p>
    </div>
  } @else {
    <mat-card class="form-card">
      <mat-card-content>
        <form [formGroup]="prestationForm" (ngSubmit)="onSubmit()" class="prestation-form">
          <div class="form-section">
            <h3>Informations générales</h3>
            
            <mat-form-field class="full-width">
              <mat-label>Libellé de la prestation *</mat-label>
              <input 
                matInput 
                formControlName="libelle" 
                placeholder="Ex: Pension chien journée">
              @if (prestationForm.get('libelle')?.hasError('required') && prestationForm.get('libelle')?.touched) {
                <mat-error>Le libellé est obligatoire</mat-error>
              }
              @if (prestationForm.get('libelle')?.hasError('maxlength')) {
                <mat-error>Le libellé ne peut pas dépasser 100 caractères</mat-error>
              }
            </mat-form-field>

            <mat-form-field class="full-width">
              <mat-label>Description *</mat-label>
              <textarea 
                matInput 
                formControlName="description" 
                placeholder="Description détaillée de la prestation..."
                rows="4">
              </textarea>
              @if (prestationForm.get('description')?.hasError('required') && prestationForm.get('description')?.touched) {
                <mat-error>La description est obligatoire</mat-error>
              }
              @if (prestationForm.get('description')?.hasError('maxlength')) {
                <mat-error>La description ne peut pas dépasser 500 caractères</mat-error>
              }
            </mat-form-field>

            <mat-form-field class="full-width">
              <mat-label>Type d'animal *</mat-label>
              <mat-select formControlName="categorieAnimal">
                @for (petType of petTypes; track petType.value) {
                  <mat-option [value]="petType.value">
                    {{ petType.label }}
                  </mat-option>
                }
              </mat-select>
              @if (prestationForm.get('categorieAnimal')?.hasError('required') && prestationForm.get('categorieAnimal')?.touched) {
                <mat-error>Le type d'animal est obligatoire</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="form-section">
            <h3>Tarification et durée</h3>
            
            <div class="form-row">
              <mat-form-field class="half-width">
                <mat-label>Prix (€) *</mat-label>
                <input 
                  matInput 
                  type="number" 
                  formControlName="prix" 
                  placeholder="0.00"
                  step="0.01"
                  min="0">
                <span matTextSuffix>€</span>
                @if (prestationForm.get('prix')?.hasError('required') && prestationForm.get('prix')?.touched) {
                  <mat-error>Le prix est obligatoire</mat-error>
                }
                @if (prestationForm.get('prix')?.hasError('min')) {
                  <mat-error>Le prix doit être positif</mat-error>
                }
              </mat-form-field>

              <mat-form-field class="half-width">
                <mat-label>Durée (minutes) *</mat-label>
                <input 
                  matInput 
                  type="number" 
                  formControlName="duree" 
                  placeholder="60"
                  min="1">
                <span matTextSuffix>min</span>
                @if (prestationForm.get('duree')?.hasError('required') && prestationForm.get('duree')?.touched) {
                  <mat-error>La durée est obligatoire</mat-error>
                }
                @if (prestationForm.get('duree')?.hasError('min')) {
                  <mat-error>La durée doit être d'au moins 1 minute</mat-error>
                }
              </mat-form-field>
            </div>
          </div>

          <div class="form-section">
            <h3>Disponibilité</h3>
            
            <div class="availability-toggle">
              <mat-slide-toggle formControlName="disponible">
                <span class="toggle-label">
                  {{ prestationForm.get('disponible')?.value ? 'Prestation disponible' : 'Prestation non disponible' }}
                </span>
              </mat-slide-toggle>
              <p class="toggle-help">
                {{ prestationForm.get('disponible')?.value 
                  ? 'Cette prestation sera visible et réservable par les clients' 
                  : 'Cette prestation ne sera pas visible pour les clients' }}
              </p>
            </div>
          </div>

          <div class="form-actions">
            <button 
              mat-button 
              type="button" 
              (click)="goBack()">
              Annuler
            </button>
            <button 
              mat-raised-button 
              color="primary" 
              type="submit"
              [disabled]="prestationForm.invalid || isSubmitting()">
              @if (isSubmitting()) {
                <mat-spinner diameter="20" style="margin-right: 8px;"></mat-spinner>
              }
              {{ isEditMode ? 'Modifier' : 'Créer' }}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  }
</div>