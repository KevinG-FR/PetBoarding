<div class="basket-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <mat-icon>shopping_cart</mat-icon>
        Mon Panier
      </mat-card-title>
      <mat-card-subtitle>
        @if (!basketService.isEmpty()) {
          {{ basketService.summary().totalItems }} réservation(s) dans le panier
        }
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      @if (basketService.loading()) {
        <div class="loading-container">
          <mat-spinner diameter="50"></mat-spinner>
          <p>Chargement du panier...</p>
        </div>
      } @else if (basketService.error()) {
        <div class="error-container">
          <mat-icon color="warn">error</mat-icon>
          <p>{{ basketService.error() }}</p>
          <button mat-button (click)="basketService.loadBasket().subscribe()">
            Réessayer
          </button>
        </div>
      } @else if (basketService.isEmpty()) {
        <div class="empty-basket">
          <mat-icon>shopping_cart</mat-icon>
          <h3>Votre panier est vide</h3>
          <p>Ajoutez des prestations depuis notre catalogue pour commencer votre réservation.</p>
          <button mat-raised-button color="primary" routerLink="/prestations">
            <mat-icon>room_service</mat-icon>
            Voir les prestations
          </button>
        </div>
      } @else {
        <div class="basket-items">
          @for (item of basketService.items(); track item.id) {
            <app-basket-item
              [item]="item"
              (remove)="onRemoveItem($event)"
              (prestationClick)="onPrestationClick($event)">
            </app-basket-item>
          }
        </div>

        <div class="basket-summary">
          <div class="summary-row">
            <span>Nombre de réservations :</span>
            <span>{{ basketService.summary().totalItems }}</span>
          </div>
          <div class="summary-row total">
            <span>Total à payer :</span>
            <span class="total-amount">
              {{ basketService.summary().totalAmount | currency: 'EUR' : 'symbol' : '1.2-2' }}
            </span>
          </div>
        </div>

        <div class="basket-actions">
          <button mat-button color="warn" (click)="onClearBasket()" class="clear-btn">
            <mat-icon>clear_all</mat-icon>
            Vider le panier
          </button>

          <button mat-raised-button color="primary" (click)="onProceedToCheckout()">
            <mat-icon>payment</mat-icon>
            Procéder au paiement
          </button>
        </div>
      }
    </mat-card-content>
  </mat-card>
</div>
